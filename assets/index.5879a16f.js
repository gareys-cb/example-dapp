import{b as k,p as x,u as y,W as S,a as h,c as A,r as c,j as b,R as I,d as E}from"./vendor.5dfdda24.js";const N=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}};N();window.Buffer=k.Buffer;window.process=x;window.util=y;var P="./assets/padlock.3a1fe527.png",O="./assets/padlock_open.c4541ffd.png";const _="YOUR_INFURA_PROJECT_ID",M="Sesame",R="https://gareys-cb.github.io/sesame/assets/padlock.png",W=`https://mainnet.infura.io/v3/${_}`,U=1,D=t=>t.makeWeb3Provider(W,U),F=async()=>{const t=new S({appName:M,appLogoUrl:R,darkMode:!1,overrideIsMetaMask:!1}),o=D(t),e=new h(o),a=await o.request({method:"eth_requestAccounts"});return{provider:o,web3:e,accounts:a}},T=async()=>{var a,n,r;const t=(r=(n=(a=window.ethereum)==null?void 0:a.providers)==null?void 0:n.find(s=>!!s.isMetaMask))!=null?r:window.ethereum;if(!t||!t.isMetaMask||!window.ethereum)throw window.open("https://metamask.io/download.html","_blank"),new Error("NO METAMASK WALLET FOUND!");const o=new h(t),e=await t.request({method:"eth_requestAccounts"});return{provider:t,web3:o,accounts:e}},j="YOUR_INFURA_PROJECT_ID",q=async()=>new Promise(async(t,o)=>{const e=new A({infuraId:j}),a=new h(e);let n=!0;const r=()=>n,s=()=>{r()&&o()};e.connector.on("disconnect",s);try{const u=await e.enable();n=!1,t({provider:e,web3:a,accounts:u})}catch{o()}}),B=async t=>{switch(t){case"walletlink":return F();case"metamask":return T();case"walletconnect":return q();default:if(!window.ethereum)throw new Error("NO WALLET FOUND!");return{provider:window.ethereum,web3:new h(window.ethereum),accounts:[]}}},f="web3-provider",J=()=>{const[t,o]=c.exports.useState(),[e,a]=c.exports.useState(),[n,r]=c.exports.useState(),[s,u]=c.exports.useState(window.localStorage.getItem(f)),l=c.exports.useCallback(()=>{localStorage.removeItem(f),a(void 0),o(void 0),r(void 0)},[e]),m=c.exports.useCallback(async d=>{try{const{provider:w,web3:C,accounts:L}=await B(d);localStorage.setItem(f,d),a(w),o(C),r(L[0])}catch{console.warn("FAILED TO SIGN IN!"),l()}},[l]);return c.exports.useEffect(()=>{u(window.localStorage.getItem(f))},[e]),c.exports.useEffect(()=>{const d=w=>{if(!w.length){l();return}r(w[0])};return e==null||e.on("accountsChanged",d),()=>{e==null||e.removeListener("accountsChanged",d)}},[e,l]),c.exports.useEffect(()=>{const d=()=>{l()};return e==null||e.on("disconnect",d),()=>{e==null||e.removeListener("disconnect",d)}},[e,l]),c.exports.useEffect(()=>{if(s!=="walletlink"){removeEventListener("beforeunload",g);return}return addEventListener("beforeunload",g),()=>{removeEventListener("beforeunload",g)}},[s]),c.exports.useEffect(()=>{s&&m(s).catch(l)},[]),{providerString:s,connectProvider:m,changeProvider:l,account:n,web3:t}},g=()=>{localStorage.getItem("-walletlink:https://www.walletlink.org:version")||localStorage.removeItem(f)},i=b.exports.jsx,p=b.exports.jsxs,v=c.exports.memo(({providerString:t,handleConnect:o,text:e})=>i("button",{type:"button",onClick:()=>o(t),children:e})),K=c.exports.memo(({handleLogin:t})=>p("div",{className:"content",children:[i("p",{children:"Connect your wallet"}),i(v,{providerString:"walletlink",handleConnect:t,text:"Coinbase Wallet"}),i(v,{providerString:"metamask",handleConnect:t,text:"MetaMask"}),i(v,{providerString:"walletconnect",handleConnect:t,text:"WalletConnect"})]})),Y=c.exports.memo(({account:t,web3:o,providerString:e,handleLogout:a})=>p("div",{className:"content",children:[i("p",{children:"Open Sesame!"}),p("small",{children:["Selected account: ",t]}),i("button",{type:"button",onClick:()=>G({web3:o,account:t}),children:"Sign Message"}),i("button",{className:"change-provider",type:"button",onClick:a,children:"Change Provider"}),p("small",{children:["Connected via ",e]})]})),G=async({web3:t,account:o})=>{try{if(!o||!t)throw new Error("NO ACCOUNT AVAILABLE");const e=await t.eth.personal.sign("Open Sesame!",o,"");console.info(e)}catch(e){console.warn(e)}};function $(){const{connectProvider:t,changeProvider:o,providerString:e,account:a,web3:n}=J(),[r,s]=c.exports.useState(!!e),u=!!a&&!!n;c.exports.useEffect(()=>{u&&r&&s(!1)},[u,r]);const l=c.exports.useCallback(async d=>{s(!0),await t(d).finally(()=>{s(!1)})},[t]),m=c.exports.useCallback(()=>{s(!0),o(),s(!1)},[o]);return p("div",{className:"App",children:[i("h1",{children:"Sesame"}),i("img",{src:u?O:P,className:"App-logo",alt:"logo"}),r?i("p",{children:"loading..."}):p("div",{children:[!u&&i(K,{handleLogin:l}),u&&i(Y,{web3:n,account:a,providerString:e,handleLogout:m})]})]})}I.render(i(E.StrictMode,{children:i($,{})}),document.getElementById("root"));
