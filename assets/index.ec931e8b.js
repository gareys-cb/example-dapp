import{b as x,p as y,u as A,W as h,C as P,a as k,r as s,j as b,R as E,c as I}from"./vendor.2e00e048.js";const N=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}};N();window.Buffer=x.Buffer;window.process=y;window.util=A;var M="./assets/padlock.3a1fe527.png",O="./assets/padlock_open.c4541ffd.png";const C="YOUR_INFURA_PROJECT_ID",W="Sesame",_="https://gareys-cb.github.io/sesame/assets/padlock.png",R=`https://mainnet.infura.io/v3/${C}`,U=1,D=()=>new P({appName:W,appLogoUrl:_,darkMode:!1,overrideIsMetaMask:!1}).makeWeb3Provider(R,U),F=async()=>{const t=D(),n=new h(t),e=await t.request({method:"eth_requestAccounts"});return{provider:t,web3:n,accounts:e}},T=()=>{var t,n,e;return(e=(n=(t=window.ethereum)==null?void 0:t.providers)==null?void 0:n.find(i=>!!i.isMetaMask))!=null?e:window.ethereum},j=async()=>{const t=T();if(!t||!t.isMetaMask||!window.ethereum)throw window.open("https://metamask.io/download.html","_blank"),new Error("NO METAMASK WALLET FOUND!");const n=new h(t),e=await t.request({method:"eth_requestAccounts"});return{provider:t,web3:n,accounts:e}},q=()=>new k({infuraId:C}),B=async()=>new Promise(async(t,n)=>{const e=q(),i=new h(e);let o=!0;const r=()=>o,c=()=>{r()&&n()};e.connector.on("disconnect",c);try{const u=await e.enable();o=!1,t({provider:e,web3:i,accounts:u})}catch{n()}}),K=async t=>{switch(t){case"coinbase":return F();case"metamask":return j();case"walletconnect":return B();default:if(!window.ethereum)throw new Error("NO WALLET FOUND!");return{provider:window.ethereum,web3:new h(window.ethereum),accounts:[]}}},f="web3-provider",G=()=>{const[t,n]=s.exports.useState(),[e,i]=s.exports.useState(),[o,r]=s.exports.useState(),[c,u]=s.exports.useState(window.localStorage.getItem(f)),d=s.exports.useCallback(()=>{localStorage.removeItem(f),i(void 0),n(void 0),r(void 0)},[e]),m=s.exports.useCallback(async l=>{try{const{provider:w,web3:S,accounts:L}=await K(l);localStorage.setItem(f,l),i(w),n(S),r(L[0])}catch{console.warn("FAILED TO SIGN IN!"),d()}},[d]);return s.exports.useEffect(()=>{const l=w=>{if(!w.length){d();return}r(w[0])};return e==null||e.on("accountsChanged",l),()=>{e==null||e.removeListener("accountsChanged",l)}},[e,d]),s.exports.useEffect(()=>{const l=()=>{d()};return e==null||e.on("disconnect",l),()=>{e==null||e.removeListener("disconnect",l)}},[e,d]),s.exports.useEffect(()=>{if(c!=="coinbase"){removeEventListener("beforeunload",g);return}return addEventListener("beforeunload",g),()=>{removeEventListener("beforeunload",g)}},[c]),s.exports.useEffect(()=>{const l=window.localStorage.getItem(f);u(l),l&&m(l).catch(d)},[]),{providerString:c,connectProvider:m,changeProvider:d,account:o,web3:t}},g=()=>{localStorage.getItem("-walletlink:https://www.walletlink.org:version")||localStorage.removeItem(f)},a=b.exports.jsx,p=b.exports.jsxs,v=s.exports.memo(({providerString:t,handleConnect:n,text:e})=>a("button",{type:"button",onClick:()=>n(t),children:e})),J=s.exports.memo(({handleConnect:t})=>p("div",{className:"content",children:[a("p",{children:"Connect your wallet"}),a(v,{providerString:"coinbase",handleConnect:t,text:"Coinbase Wallet"}),a(v,{providerString:"metamask",handleConnect:t,text:"MetaMask"}),a(v,{providerString:"walletconnect",handleConnect:t,text:"WalletConnect"})]})),Y=s.exports.memo(({account:t,web3:n,providerString:e,handleLogout:i})=>p("div",{className:"content",children:[a("p",{children:"Open Sesame!"}),p("small",{children:["Selected account: ",t]}),a("button",{type:"button",onClick:()=>$({web3:n,account:t}),children:"Sign Message"}),a("button",{className:"change-provider",type:"button",onClick:i,children:"Change Provider"}),p("small",{children:["Connected via ",e]})]})),$=async({web3:t,account:n})=>{try{if(!n||!t)throw new Error("NO ACCOUNT AVAILABLE");const e=await t.eth.personal.sign("Open Sesame!",n,"");console.info(e)}catch(e){console.warn(e)}};function H(){const{connectProvider:t,changeProvider:n,providerString:e,account:i,web3:o}=G(),[r,c]=s.exports.useState(!!e),u=!!i&&!!o;s.exports.useEffect(()=>{u&&r&&c(!1)},[u,r]);const d=s.exports.useCallback(async l=>{c(!0),await t(l).finally(()=>{c(!1)})},[t]),m=s.exports.useCallback(()=>{c(!0),n(),c(!1)},[n]);return p("div",{className:"App",children:[a("h1",{children:"Sesame"}),a("img",{src:u?O:M,className:"App-logo",alt:"logo"}),r?a("p",{children:"loading..."}):p("div",{children:[!u&&a(J,{handleConnect:d}),u&&a(Y,{web3:o,account:i,providerString:e,handleLogout:m})]})]})}E.render(a(I.StrictMode,{children:a(H,{})}),document.getElementById("root"));
